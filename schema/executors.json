{
    "$schema": "http://json-schema.org/draft-04/schema#",
    "title": "Routers",
    "description": "Kanro router config",
    "type": "object",
    "properties": {
        "entryPoint": {
            "type": "object",
            "description": "The first request handler",
            "anyOf": [
                {
                    "$ref": "#/definitions/router"
                },
                {
                    "$ref": "#/definitions/requestHandler"
                },
                {
                    "$ref": "#/definitions/requestDiverter"
                },
                {
                    "$ref": "#/definitions/requestReplicator"
                },
                {
                    "$ref": "#/definitions/responder"
                }
            ]
        },
        "globalRequestHandler": {
            "type": "object",
            "description": "The global request handler",
            "anyOf": [
                {
                    "$ref": "#/definitions/globalRequestHandler"
                }
            ]
        },
        "globalResponseHandler": {
            "type": "object",
            "description": "The global response handler",
            "anyOf": [
                {
                    "$ref": "#/definitions/globalResponseHandler"
                }
            ]
        },
        "globalExceptionHandlers": {
            "type": "array",
            "description": "The global exception handlers",
            "items": {
                "type": "object",
                "description": "Global exception handler",
                "anyOf": [
                    {
                        "$ref": "#/definitions/globalExceptionHandler"
                    }
                ]
            }
        }
    },
    "required": [
        "entryPoint"
    ],
    "definitions": {
        "module": {
            "title": "Module",
            "description": "A Kanro modules",
            "type": "object",
            "properties": {
                "name": {
                    "type": "string",
                    "description": "Name of the module",
                    "pattern": "^[a-z0-9@]([a-z0-9@/_\\.]{0,212}?)[a-z0-9]?$"
                },
                "version": {
                    "type": "string",
                    "description": "Version of the module",
                    "pattern": "^([0-9]+\\.[0-9]+.[0-9]+(?:-[a-zA-Z0-9\\-\\.]+)?|\\*)$"
                }
            },
            "required": [
                "name",
                "version"
            ]
        },
        "router": {
            "title": "Router",
            "description": "A Kanro router",
            "type": "object",
            "properties": {
                "name": {
                    "type": "string",
                    "description": "Node name",
                    "pattern": "KanroRouter"
                },
                "module": {
                    "type": "object",
                    "description": "Node module info",
                    "anyOf": [
                        {
                            "$ref": "#/definitions/module"
                        }
                    ],
                    "default": {
                        "name": "kanro.core",
                        "version": "*"
                    }
                },
                "type": {
                    "type": "string",
                    "description": "Node type",
                    "enum": [
                        "RequestDiverter"
                    ]
                },
                "exceptionHandlers": {
                    "type": "array",
                    "description": "Exception handler in this router",
                    "items": {
                        "type": "object",
                        "anyOf": [
                            {
                                "$ref": "#/definitions/exceptionHandler"
                            }
                        ]
                    }
                },
                "fuses": {
                    "type": "array",
                    "description": "Fuses in this router",
                    "items": {
                        "type": "object",
                        "anyOf": [
                            {
                                "$ref": "#/definitions/fuse"
                            }
                        ]
                    }
                }
            },
            "patternProperties": {
                "^\/": {
                    "type": "object",
                    "anyOf": [
                        {
                            "$ref": "#/definitions/requestHandler"
                        },
                        {
                            "$ref": "#/definitions/requestDiverter"
                        },
                        {
                            "$ref": "#/definitions/requestReplicator"
                        },
                        {
                            "$ref": "#/definitions/responder"
                        },
                        {
                            "$ref": "#/definitions/router"
                        }
                    ]
                }
            },
            "required": [
                "name",
                "type"
            ]
        },
        "requestHandler": {
            "title": "RequestHandler",
            "description": "A Kanro request handler",
            "type": "object",
            "properties": {
                "name": {
                    "type": "string",
                    "description": "Node name"
                },
                "module": {
                    "type": "object",
                    "description": "Node module info",
                    "anyOf": [
                        {
                            "$ref": "#/definitions/module"
                        }
                    ]
                },
                "next": {
                    "type": "object",
                    "description": "Next node",
                    "anyOf": [
                        {
                            "$ref": "#/definitions/requestHandler"
                        },
                        {
                            "$ref": "#/definitions/requestDiverter"
                        },
                        {
                            "$ref": "#/definitions/requestReplicator"
                        },
                        {
                            "$ref": "#/definitions/responder"
                        },
                        {
                            "$ref": "#/definitions/router"
                        }
                    ]
                },
                "type": {
                    "type": "string",
                    "description": "Node type",
                    "enum": [
                        "RequestHandler"
                    ]
                },
                "exceptionHandlers": {
                    "type": "array",
                    "description": "Exception handler in this router",
                    "items": {
                        "type": "object",
                        "anyOf": [
                            {
                                "$ref": "#/definitions/exceptionHandler"
                            }
                        ]
                    }
                },
                "fuses": {
                    "type": "array",
                    "description": "Fuses in this router",
                    "items": {
                        "type": "object",
                        "anyOf": [
                            {
                                "$ref": "#/definitions/fuse"
                            }
                        ]
                    }
                },
                "dependencies": {
                    "type": "array",
                    "items": {
                        "type": "object",
                        "anyOf": [
                            {
                                "$ref": "#/definitions/serviceDependencies"
                            }
                        ]
                    }
                }
            },
            "required": [
                "name",
                "module",
                "next",
                "type"
            ]
        },
        "requestDiverter": {
            "title": "RequestDiverter",
            "description": "A Kanro request diverter",
            "type": "object",
            "properties": {
                "name": {
                    "type": "string",
                    "description": "Node name",
                    "pattern": "^((?!KanroRouter).)*$"
                },
                "module": {
                    "type": "object",
                    "description": "Node module info",
                    "anyOf": [
                        {
                            "$ref": "#/definitions/module"
                        }
                    ]
                },
                "next": {
                    "type": "array",
                    "description": "Next nodes",
                    "items": {
                        "type": "object",
                        "description": "Next node",
                        "anyOf": [
                            {
                                "$ref": "#/definitions/requestHandler"
                            },
                            {
                                "$ref": "#/definitions/requestDiverter"
                            },
                            {
                                "$ref": "#/definitions/requestReplicator"
                            },
                            {
                                "$ref": "#/definitions/responder"
                            },
                            {
                                "$ref": "#/definitions/router"
                            }
                        ]
                    }
                },
                "type": {
                    "type": "string",
                    "description": "Node type",
                    "enum": [
                        "RequestDiverter"
                    ]
                },
                "exceptionHandlers": {
                    "type": "array",
                    "description": "Exception handler in this router",
                    "items": {
                        "type": "object",
                        "anyOf": [
                            {
                                "$ref": "#/definitions/exceptionHandler"
                            }
                        ]
                    }
                },
                "fuses": {
                    "type": "array",
                    "description": "Fuses in this router",
                    "items": {
                        "type": "object",
                        "anyOf": [
                            {
                                "$ref": "#/definitions/fuse"
                            }
                        ]
                    }
                },
                "dependencies": {
                    "type": "array",
                    "items": {
                        "type": "object",
                        "anyOf": [
                            {
                                "$ref": "#/definitions/serviceDependencies"
                            }
                        ]
                    }
                }
            },
            "required": [
                "name",
                "module",
                "next",
                "type"
            ]
        },
        "requestReplicator": {
            "title": "RequestReplicator",
            "description": "A Kanro request replicator",
            "type": "object",
            "properties": {
                "name": {
                    "type": "string",
                    "description": "Node name"
                },
                "module": {
                    "type": "object",
                    "description": "Node module info",
                    "anyOf": [
                        {
                            "$ref": "#/definitions/module"
                        }
                    ]
                },
                "next": {
                    "type": "array",
                    "description": "Next nodes",
                    "items": {
                        "type": "object",
                        "description": "Next node",
                        "anyOf": [
                            {
                                "$ref": "#/definitions/requestHandler"
                            },
                            {
                                "$ref": "#/definitions/requestDiverter"
                            },
                            {
                                "$ref": "#/definitions/requestReplicator"
                            },
                            {
                                "$ref": "#/definitions/responder"
                            },
                            {
                                "$ref": "#/definitions/router"
                            }
                        ]
                    }
                },
                "type": {
                    "type": "string",
                    "description": "Node type",
                    "enum": [
                        "RequestReplicator"
                    ]
                },
                "exceptionHandlers": {
                    "type": "array",
                    "description": "Exception handler in this router",
                    "items": {
                        "type": "object",
                        "anyOf": [
                            {
                                "$ref": "#/definitions/exceptionHandler"
                            }
                        ]
                    }
                },
                "fuses": {
                    "type": "array",
                    "description": "Fuses in this router",
                    "items": {
                        "type": "object",
                        "anyOf": [
                            {
                                "$ref": "#/definitions/fuse"
                            }
                        ]
                    }
                },
                "dependencies": {
                    "type": "array",
                    "items": {
                        "type": "object",
                        "anyOf": [
                            {
                                "$ref": "#/definitions/serviceDependencies"
                            }
                        ]
                    }
                }
            },
            "required": [
                "name",
                "module",
                "next",
                "type"
            ]
        },
        "responder": {
            "title": "Responder",
            "description": "A Kanro responder",
            "type": "object",
            "properties": {
                "name": {
                    "type": "string",
                    "description": "Node name"
                },
                "module": {
                    "type": "object",
                    "description": "Node module info",
                    "anyOf": [
                        {
                            "$ref": "#/definitions/module"
                        }
                    ]
                },
                "next": {
                    "type": "object",
                    "description": "Next node",
                    "anyOf": [
                        {
                            "$ref": "#/definitions/responseHandler"
                        }
                    ]
                },
                "exceptionHandlers": {
                    "type": "array",
                    "description": "Exception handler in this router",
                    "items": {
                        "type": "object",
                        "anyOf": [
                            {
                                "$ref": "#/definitions/exceptionHandler"
                            }
                        ]
                    }
                },
                "fuses": {
                    "type": "array",
                    "description": "Fuses in this router",
                    "items": {
                        "type": "object",
                        "anyOf": [
                            {
                                "$ref": "#/definitions/fuse"
                            }
                        ]
                    }
                },
                "dependencies": {
                    "type": "array",
                    "items": {
                        "type": "object",
                        "anyOf": [
                            {
                                "$ref": "#/definitions/serviceDependencies"
                            }
                        ]
                    }
                }
            },
            "required": [
                "name",
                "module",
                "type"
            ]
        },
        "responseHandler": {
            "title": "ResponseHandler",
            "description": "A Kanro response handler",
            "type": "object",
            "properties": {
                "name": {
                    "type": "string",
                    "description": "Node name"
                },
                "module": {
                    "type": "object",
                    "description": "Node module info",
                    "anyOf": [
                        {
                            "$ref": "#/definitions/module"
                        }
                    ]
                },
                "next": {
                    "type": "object",
                    "description": "Next node",
                    "anyOf": [
                        {
                            "$ref": "#/definitions/responseHandler"
                        }
                    ]
                },
                "exceptionHandlers": {
                    "type": "array",
                    "description": "Exception handler in this router",
                    "items": {
                        "type": "object",
                        "anyOf": [
                            {
                                "$ref": "#/definitions/exceptionHandler"
                            }
                        ]
                    }
                },
                "fuses": {
                    "type": "array",
                    "description": "Fuses in this router",
                    "items": {
                        "type": "object",
                        "anyOf": [
                            {
                                "$ref": "#/definitions/fuse"
                            }
                        ]
                    }
                },
                "dependencies": {
                    "type": "array",
                    "items": {
                        "type": "object",
                        "anyOf": [
                            {
                                "$ref": "#/definitions/serviceDependencies"
                            }
                        ]
                    }
                }
            },
            "required": [
                "name",
                "module",
                "type"
            ]
        },
        "exceptionHandler": {
            "title": "ExceptionHandler",
            "description": "A Kanro exception handler",
            "type": "object",
            "properties": {
                "name": {
                    "type": "string",
                    "description": "Node name"
                },
                "module": {
                    "type": "object",
                    "description": "Node module info",
                    "anyOf": [
                        {
                            "$ref": "#/definitions/module"
                        }
                    ]
                },
                "next": {
                    "type": "object",
                    "description": "Next node",
                    "anyOf": [
                        {
                            "$ref": "#/definitions/responseHandler"
                        }
                    ]
                },
                "type": {
                    "type": "string",
                    "description": "Node type",
                    "enum": [
                        "ExceptionHandler"
                    ]
                },
                "exceptionHandlers": {
                    "type": "array",
                    "description": "Exception handler in this router",
                    "items": {
                        "type": "object",
                        "anyOf": [
                            {
                                "$ref": "#/definitions/exceptionHandler"
                            }
                        ]
                    }
                },
                "fuses": {
                    "type": "array",
                    "description": "Fuses in this router",
                    "items": {
                        "type": "object",
                        "anyOf": [
                            {
                                "$ref": "#/definitions/fuse"
                            }
                        ]
                    }
                },
                "dependencies": {
                    "type": "object",
                    "anyOf": [
                        {
                            "$ref": "#/definitions/serviceDependencies"
                        }
                    ]
                }
            },
            "required": [
                "name",
                "module",
                "type"
            ]
        },
        "fuse": {
            "title": "Fuse",
            "description": "A Kanro fuse",
            "type": "object",
            "properties": {
                "name": {
                    "type": "string",
                    "description": "Node name"
                },
                "module": {
                    "type": "object",
                    "description": "Node module info",
                    "anyOf": [
                        {
                            "$ref": "#/definitions/module"
                        }
                    ]
                },
                "next": {
                    "type": "object",
                    "description": "Next node",
                    "anyOf": [
                        {
                            "$ref": "#/definitions/requestHandler"
                        },
                        {
                            "$ref": "#/definitions/requestDiverter"
                        },
                        {
                            "$ref": "#/definitions/requestReplicator"
                        },
                        {
                            "$ref": "#/definitions/responder"
                        }
                    ]
                },
                "type": {
                    "type": "string",
                    "description": "Node type",
                    "enum": [
                        "Fuse"
                    ]
                },
                "exceptionHandlers": {
                    "type": "array",
                    "description": "Exception handler in this router",
                    "items": {
                        "type": "object",
                        "anyOf": [
                            {
                                "$ref": "#/definitions/exceptionHandler"
                            }
                        ]
                    }
                },
                "fuses": {
                    "type": "array",
                    "description": "Fuses in this router",
                    "items": {
                        "type": "object",
                        "anyOf": [
                            {
                                "$ref": "#/definitions/fuse"
                            }
                        ]
                    }
                },
                "dependencies": {
                    "type": "array",
                    "items": {
                        "type": "object",
                        "anyOf": [
                            {
                                "$ref": "#/definitions/serviceDependencies"
                            }
                        ]
                    }
                }
            },
            "required": [
                "name",
                "module",
                "next",
                "type"
            ]
        },
        "globalRequestHandler": {
            "title": "GlobalRequestHandler",
            "description": "A global Kanro request handler",
            "type": "object",
            "properties": {
                "name": {
                    "type": "string",
                    "description": "Node name"
                },
                "module": {
                    "type": "object",
                    "description": "Node module info",
                    "anyOf": [
                        {
                            "$ref": "#/definitions/module"
                        }
                    ]
                },
                "next": {
                    "type": "object",
                    "description": "Next node",
                    "anyOf": [
                        {
                            "$ref": "#/definitions/globalRequestHandler"
                        }
                    ]
                },
                "type": {
                    "type": "string",
                    "description": "Node type",
                    "enum": [
                        "GlobalRequestHandler"
                    ]
                },
                "exceptionHandlers": {
                    "type": "array",
                    "description": "Exception handler in this router",
                    "items": {
                        "type": "object",
                        "anyOf": [
                            {
                                "$ref": "#/definitions/exceptionHandler"
                            }
                        ]
                    }
                },
                "fuses": {
                    "type": "array",
                    "description": "Fuses in this router",
                    "items": {
                        "type": "object",
                        "anyOf": [
                            {
                                "$ref": "#/definitions/fuse"
                            }
                        ]
                    }
                },
                "dependencies": {
                    "type": "array",
                    "items": {
                        "type": "object",
                        "anyOf": [
                            {
                                "$ref": "#/definitions/serviceDependencies"
                            }
                        ]
                    }
                }
            },
            "required": [
                "name",
                "module",
                "type"
            ]
        },
        "globalResponseHandler": {
            "title": "GlobalResponseHandler",
            "description": "A global Kanro response handler",
            "type": "object",
            "properties": {
                "name": {
                    "type": "string",
                    "description": "Node name"
                },
                "module": {
                    "type": "object",
                    "description": "Node module info",
                    "anyOf": [
                        {
                            "$ref": "#/definitions/module"
                        }
                    ]
                },
                "next": {
                    "type": "object",
                    "description": "Next node",
                    "anyOf": [
                        {
                            "$ref": "#/definitions/globalResponseHandler"
                        }
                    ]
                },
                "type": {
                    "type": "string",
                    "description": "Node type",
                    "enum": [
                        "GlobalResponseHandler"
                    ]
                },
                "exceptionHandlers": {
                    "type": "array",
                    "description": "Exception handler in this router",
                    "items": {
                        "type": "object",
                        "anyOf": [
                            {
                                "$ref": "#/definitions/exceptionHandler"
                            }
                        ]
                    }
                },
                "fuses": {
                    "type": "array",
                    "description": "Fuses in this router",
                    "items": {
                        "type": "object",
                        "anyOf": [
                            {
                                "$ref": "#/definitions/fuse"
                            }
                        ]
                    }
                },
                "dependencies": {
                    "type": "array",
                    "items": {
                        "type": "object",
                        "anyOf": [
                            {
                                "$ref": "#/definitions/serviceDependencies"
                            }
                        ]
                    }
                }
            },
            "required": [
                "name",
                "module",
                "type"
            ]
        },
        "globalExceptionHandler": {
            "title": "GlobalExceptionHandler",
            "description": "A global Kanro exception handler",
            "type": "object",
            "properties": {
                "name": {
                    "type": "string",
                    "description": "Node name"
                },
                "module": {
                    "type": "object",
                    "description": "Node module info",
                    "anyOf": [
                        {
                            "$ref": "#/definitions/module"
                        }
                    ]
                },
                "next": {
                    "type": "object",
                    "description": "Next node",
                    "anyOf": [
                        {
                            "$ref": "#/definitions/responseHandler"
                        }
                    ]
                },
                "type": {
                    "type": "string",
                    "description": "Node type",
                    "enum": [
                        "GlobalExceptionHandler"
                    ]
                },
                "exceptionHandlers": {
                    "type": "array",
                    "description": "Exception handler in this router",
                    "items": {
                        "type": "object",
                        "anyOf": [
                            {
                                "$ref": "#/definitions/exceptionHandler"
                            }
                        ]
                    }
                },
                "fuses": {
                    "type": "array",
                    "description": "Fuses in this router",
                    "items": {
                        "type": "object",
                        "anyOf": [
                            {
                                "$ref": "#/definitions/fuse"
                            }
                        ]
                    }
                },
                "dependencies": {
                    "type": "array",
                    "items": {
                        "type": "object",
                        "anyOf": [
                            {
                                "$ref": "#/definitions/serviceDependencies"
                            }
                        ]
                    }
                }
            },
            "required": [
                "name",
                "module",
                "type"
            ]
        },
        "serviceDependencies": {
            "type": "object",
            "properties": {
                "name": {
                    "type": "string"
                },
                "module": {
                    "type": "object",
                    "anyOf": [
                        {
                            "$ref": "#/definitions/module"
                        }
                    ]
                },
                "type": {
                    "type": "string",
                    "description": "Node type",
                    "enum": [
                        "Service"
                    ]
                }
            },
            "required": [
                "name",
                "module"
            ]
        }
    }
}